---
layout: post
header-img: img/default-blog-pic.jpg
---

# Spring MVC Controller Testing : The right and easy way...

The other day I was playing with Spring MVC to create some demo app. For writing test cases for the Spring MVC Controllers, I used the normal way described in most of the blogs I searched. But few days later, I came to know about [spring-test-mvc](https://github.com/SpringSource/spring-test-mvc) module by springsource guys. I must say its simply awesome. All the boiler place code is gone now and writing test cases is more fun. For the lazy readers and code addicts here is the link to [GitHub Repo](https://github.com/vijayrawatsan/spring-mvc-test).  Now lets get back, below is the Controller class I will be testing in this blog : [code language="java"] package in.xebia.mvc.controller; //all the imports @Controller public class MainController { protected static Logger logger = Logger.getLogger("MainController"); @Autowired private UserRepository userRepository; @RequestMapping(value = "/", method = RequestMethod.GET) public String home() { return "login"; } @RequestMapping(value = "/login", method = RequestMethod.POST) public String login(@Valid User user, BindingResult result, Model model) { if(result.hasErrors()){ model.addAttribute("STATUS", "INVALID LOGIN"); return "redirect:/login"; } if(userRepository.findByUserNameAndPassword(user.getUserName(), user.getPassword())!=null){ model.addAttribute("STATUS", "SUCCESS"); return "home"; } model.addAttribute("STATUS", "DOES NOT EXIST"); return "redirect:/login"; } @RequestMapping(value = "/users/all", method = RequestMethod.GET) public @ResponseBody List<User> getAllUsers() { return userRepository.findAll(); } @RequestMapping(value = "/users/{userName}", method = RequestMethod.GET) public @ResponseBody User getUser(@PathVariable String userName) { return userRepository.findByUserName(userName); } @RequestMapping(value = "/users", method = RequestMethod.GET) public @ResponseBody User getUserByRequestParameter(@RequestParam String userName) { return userRepository.findByUserName(userName); } } [/code] I have tried to test most of the use cases like, GET, POST with parameters, GET with parameters, **@ResponseBody**, **@RequestParam**, **@Valid** , **@PathVariable**, Model Attributes, View Names, etc. Below are the Test Cases I wrote earlier(before I knew about spring-test-mvc): [code language="java"] package in.xebia.mvc.controllers.test; @SuppressWarnings("unused") public class MainControllerTest extends AbstractTest { private static final String SUCCESS = "SUCCESS"; private static final String INVALID_LOGIN = "INVALID LOGIN"; private static final String DOES_NOT_EXIST = "DOES NOT EXIST"; private static final String STATUS = "STATUS"; /** * json mapper */ ObjectMapper mapper = new ObjectMapper(); @Autowired private UserRepository userRepository; @Autowired private RequestMappingHandlerAdapter handlerAdapter; @Autowired private RequestMappingHandlerMapping handlerMapping; private MockHttpServletRequest request; private MockHttpServletResponse response; @Before public void setUp() { request = new MockHttpServletRequest(); response = new MockHttpServletResponse(); } @Test public void testHome() throws Exception { request.setMethod("GET"); request.setRequestURI("/"); Object handler = handlerMapping.getHandler(request).getHandler(); ModelAndView modelAndView = handlerAdapter.handle(request, response, handler); assertViewName(modelAndView, "login"); } @Test public void testInvalidLogin() throws Exception { request.setMethod("POST"); request.setRequestURI("/login"); request.setParameter("userName", "vijayrawat"); Object handler = handlerMapping.getHandler(request).getHandler(); final ModelAndView modelAndView = handlerAdapter.handle(request, response, handler); assertViewName(modelAndView, "redirect:/login"); final BindingResult errors = assertAndReturnModelAttributeOfType(modelAndView, "org.springframework.validation.BindingResult.user", BindingResult.class); System.out.println(errors.getAllErrors()); assertEquals(1, errors.getErrorCount()); assertModelAttributeValue(modelAndView, STATUS, INVALID_LOGIN); } @Test public void testSuccessfulLogin() throws Exception { request.setMethod("POST"); request.setRequestURI("/login"); request.setParameter("userName", "vijay"); request.setParameter("password", "1a1dc91c907325c69271ddf0c944bc72"); Object handler = handlerMapping.getHandler(request).getHandler(); final ModelAndView modelAndView = handlerAdapter.handle(request, response, handler); assertViewName(modelAndView, "home"); assertModelAttributeValue(modelAndView, STATUS, SUCCESS); } @Test public void testDoesNotExistLogin() throws Exception { request.setMethod("POST"); request.setRequestURI("/login"); request.setParameter("userName", "vijay"); request.setParameter("password", "some random pass"); Object handler = handlerMapping.getHandler(request).getHandler(); final ModelAndView modelAndView = handlerAdapter.handle(request, response, handler); assertViewName(modelAndView, "redirect:/login"); assertModelAttributeValue(modelAndView, STATUS, DOES_NOT_EXIST); } @Test public void testGetUsers() throws Exception { request.setMethod("GET"); request.setRequestURI("/users/vijay"); Object handler = handlerMapping.getHandler(request).getHandler(); HttpMessageConverter<?>[] messageConverters = {new MappingJacksonHttpMessageConverter()}; handlerAdapter.setMessageConverters(Arrays.asList(messageConverters)); final ModelAndView modelAndView = handlerAdapter.handle(request, response, handler); assertEquals(mapper.writeValueAsString(userRepository.findByUserName("vijay")), response.getContentAsString()); } @Test public void testGetAllUsers() throws Exception { request.setMethod("GET"); request.setRequestURI("/users/all"); Object handler = handlerMapping.getHandler(request).getHandler(); HttpMessageConverter<?>[] messageConverters = {new MappingJacksonHttpMessageConverter()}; handlerAdapter.setMessageConverters(Arrays.asList(messageConverters)); final ModelAndView modelAndView = handlerAdapter.handle(request, response, handler); assertEquals(mapper.writeValueAsString(userRepository.findAll()), response.getContentAsString()); } /** * Test @RequestParam * @throws Exception */ @Test public void testgetUsers() throws Exception { request.setMethod("GET"); request.setRequestURI("/users"); request.setParameter("userName", "vijay"); Object handler = handlerMapping.getHandler(request).getHandler(); HttpMessageConverter<?>[] messageConverters = {new MappingJacksonHttpMessageConverter()}; handlerAdapter.setMessageConverters(Arrays.asList(messageConverters)); final ModelAndView modelAndView = handlerAdapter.handle(request, response, handler); System.out.println(response.getContentAsString()); assertEquals(mapper.writeValueAsString(userRepository.findByUserName("vijay")), response.getContentAsString()); } } [/code] Lets compare the above code with the new test cases written below(after learning about spring-test-mvc): [code language="java"] package in.xebia.mvc.controllers.test; //important imports @SuppressWarnings("unused") @RunWith(SpringJUnit4ClassRunner.class)

## Comments

**[Luciano](#8914 "2012-06-01 00:54:58"):** Very good examples m8, they pretty much cover all the main use cases. Compliments

**[Panka Sharma](#8943 "2012-06-04 08:15:27"):** Thanks for writing ..Very nice article. - javapins.com

**[Jaya](#9445 "2013-09-20 21:52:13"):** Very nice blog. Easy to understand and good to know this type of stuff.

